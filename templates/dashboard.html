{% extends "base.html" %}
{% block stylesheet %}<link rel="stylesheet" href="/static/css/dash.css">{% endblock %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="dashboard">
    <div class="sidebar">
        <div class="sidebar-island">
            <div class="profile-section">
                <img src="{{ profile_image_url }}" alt="Profile Photo" class="profile-photo">
                <div class="profile-info">
                    <div class="profile-name">{{ username }}</div>
                    <div class="profile-email">{{ email }}</div>
                </div>
            </div>

            <div class="sidebar-divider"></div>

            <div class="sidebar-buttons">
                <div class="sidebar-dropdown">
                    {% if active_section == 'workouts' %}
                        <div class="sidebar-button dropdown-toggle active" onclick="toggleDropdown()" id="workoutsSidebarBtn">
                            Workouts
                        </div>
                        <div class="dropdown-menu open" id="workoutDropdown">
                            <a href="{{ url_for('workouts') }}"
                               class="dropdown-item{% if not selected_type %} selected{% endif %}"
                               onclick="selectDropdown(event, this)">All</a>
                            <a href="{{ url_for('workouts', type='strength') }}"
                               class="dropdown-item{% if selected_type == 'strength' %} selected{% endif %}"
                               onclick="selectDropdown(event, this)">Strength</a>
                            <a href="{{ url_for('workouts', type='cardio') }}"
                               class="dropdown-item{% if selected_type == 'cardio' %} selected{% endif %}"
                               onclick="selectDropdown(event, this)">Cardio</a>
                            <a href="{{ url_for('workouts', type='flexibility') }}"
                               class="dropdown-item{% if selected_type == 'flexibility' %} selected{% endif %}"
                               onclick="selectDropdown(event, this)">Flexibility</a>
                        </div>
                    {% else %}
                        <a href="{{ url_for('workouts') }}" class="sidebar-button" id="workoutsSidebarBtn">Workouts</a>
                    {% endif %}
                </div>
                <a href="{{ url_for('logout') }}" class="sidebar-button logout-button">Logout</a>
            </div>
        </div>
    </div>
    <div class="main">
        {% if active_section == 'home' %}
            <h1>Hello {{ username }}!</h1>
            <div class="main-sections">
                <div class="main-card">
                    <h2>Workouts</h2>
                    <p>Here you can track your recent workouts and start new ones.</p>
                </div>
                <div class="main-card">
                    <h2>Stats</h2>
                    <p>Your progress and stats will appear here.</p>
                </div>
            </div>
        {% elif active_section == 'workouts' %}
            <div class="main-sections center-content">
                <div class="workout-section">
                    <h1>Workouts</h1>
                    <button id="openWorkoutModal" class="sidebar-button">+ Create Workout</button>
                    <div class="workouts-list">
                        {% if workouts %}
                            {% for workout in workouts %}
                                <div class="workout-card">
                                    <div class="workout-card-header">
                                        <h3>{{ workout.name }}</h3>
                                        <span class="workout-type">{{ workout.type|capitalize }}</span>
                                    </div>
                                    <div class="workout-card-body">
                                        <div><strong>Duration:</strong> {{ workout.duration }} min</div>
                                        <div><strong>Difficulty:</strong> {{ workout.difficulty|capitalize or "N/A" }}</div>
                                        <div><strong>Description:</strong> {{ workout.description or "No description" }}</div>
                                        <div class="workout-date"><small>Created: {{ workout.created_at.strftime('%Y-%m-%d') }}</small></div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <p>No workouts yet. Create your first workout!</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>
{% if active_section == 'workouts' %}

<div id="workoutModal" class="modal" style="display:none;">
    <div class="modal-content">
        <span class="close" id="closeWorkoutModal">&times;</span>
        <h2>Create Workout</h2>
        <form method="POST" action="{{ url_for('create_workout') }}">
            {{ workout_form.hidden_tag() }}
            <div>{{ workout_form.name.label }} {{ workout_form.name() }}</div>
            <div>{{ workout_form.type.label }} {{ workout_form.type() }}</div>
            <div>{{ workout_form.duration.label }} {{ workout_form.duration() }}</div>
            <div>{{ workout_form.difficulty.label }} {{ workout_form.difficulty() }}</div>
            <div>{{ workout_form.description.label }} {{ workout_form.description() }}</div>
            <div>{{ workout_form.submit() }}</div>
        </form>
    </div>
</div>
<script>
function toggleDropdown() {
    const dropdown = document.getElementById('workoutDropdown');
    const toggleBtn = document.querySelector('.dropdown-toggle');
    dropdown.classList.toggle('open');
    toggleBtn.classList.toggle('open');
}

const openBtn = document.getElementById('openWorkoutModal');
if (openBtn) openBtn.onclick = function() {
    document.getElementById('workoutModal').style.display = 'flex';
}

const closeBtn = document.getElementById('closeWorkoutModal');
if (closeBtn) closeBtn.onclick = function() {
    document.getElementById('workoutModal').style.display = 'none';
}

window.onclick = function(event) {
    const modal = document.getElementById('workoutModal');
    if (event.target == modal) {
        modal.style.display = "none";
    }
}

function selectDropdown(event, el) {
    event.preventDefault();
    window.location = el.href;
}
</script>
{% endif %}
{% endblock %}